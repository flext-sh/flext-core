[build-system]
build-backend = "poetry.core.masonry.api"
requires = [ "poetry-core>=2" ]

[project]
name = "flext-core"
version = "0.10.0-dev"
description = "Enterprise Foundation Framework - Modern Python 3.13 + Clean Architecture"
readme = "README.md"
keywords = [
  "clean-architecture",
  "ddd",
  "enterprise",
  "flext",
  "modern",
  "solid",
]
license = "MIT"
maintainers = [ { email = "team@flext.sh", name = "FLEXT Team" } ]
authors = [ { email = "team@flext.sh", name = "FLEXT Team" } ]
requires-python = ">=3.13,<3.14"
classifiers = [
  "Development Status :: 5 - Production/Stable",
  "Framework :: Pydantic",
  "Framework :: Pydantic :: 2",
  "Intended Audience :: Developers",
  "Operating System :: OS Independent",
  "Programming Language :: Python :: 3 :: Only",
  "Programming Language :: Python :: 3.13",
  "Topic :: Software Development :: Libraries :: Application Frameworks",
  "Typing :: Typed",
]
dependencies = [
  "attrs>=25.4,<26",
  "beartype>=0.19",
  "cachetools>=5.3",
  "dependency-injector>=4.41",
  "docker>=7.1,<8",
  "limits>=3.6",
  "orjson>=3.11.3",
  "pybreaker>=0.8",
  "pydantic>=2.12.3",
  "pydantic-core>=2.41.4",
  "pydantic-settings>=2.10.1",
  "python-dotenv>=1",
  "python-on-whales>=0.79,<0.80",
  "pyyaml>=6.0.2",
  "returns>=0.26",
  "structlog>=25.4",
  "wrapt>=1.17,<2",
]
optional-dependencies.dev = [
  "autoflake>=2.3.1",
  "bandit>=1.8",
  "beartype>=0.19",
  "black>=25.1",
  "codespell>=2.3",
  "deptry>=0.23",
  "detect-secrets>=1.5",
  "django-stubs>=5.2.2",
  "factory-boy>=3.3.1",
  "faker>=37.4",
  "hypothesis>=6.125",
  "interrogate>=1.7",
  "isort>=6.0.1",
  "mypy>=1.18.2",
  "pip-audit>=2.7.3",
  "pre-commit>=4.0.1",
  "pylint>=3.3",
  "pytest>=8.4",
  "pytest-benchmark>=5.1",
  "pytest-clarity>=1.0.1",
  "pytest-cov>=6.2",
  "pytest-deadfixtures>=2.2.1",
  "pytest-env>=1.1.5",
  "pytest-mock>=3.14",
  "pytest-randomly>=3.16",
  "pytest-sugar>=1",
  "pytest-timeout>=2.4",
  "pytest-xdist>=3.8",
  "pyupgrade>=3.19",
  "radon>=6.0.1",
  "ruff>=0.12.3",
  "types-cachetools>=5.3",
  "types-docker>=7.1",
  "types-ldap3>=2.9.13.20250622",
  "types-protobuf>=6.30.2.20250703",
  "types-psutil>=7",
  "types-psycopg2>=2.9.21.20250718",
  "types-python-dateutil>=2.9",
  "types-pyyaml>=6.0.12",
  "types-redis>=4.6",
  "types-requests>=2.32.4",
  "types-setuptools>=80.9",
  "types-toml>=0.10.8.20240310",
  "uv>=0.9.6",
  "vulture>=2.13",
]
urls.Documentation = "https://github.com/flext-sh/flext-core/blob/main/README.md"
urls.Homepage = "https://github.com/flext-sh/flext-core"
urls.Repository = "https://github.com/flext-sh/flext-core"

[tool]
[tool.poetry]
packages = [
  { include = "flext_core", from = "src" },
  { include = "flext_tests", from = "src" },
]
group.dev.dependencies.beartype = "^0.22.9"
group.dev.dependencies.click = "^8.3.0"
group.dev.dependencies.coverage = "^7.13.1"
group.dev.dependencies.hypothesis = "^6.148.7"
group.dev.dependencies.pyrefly = "^0.46.3"
group.dev.dependencies.pytest = "^9.0.2"
group.dev.dependencies.pytest-cov = "^7.0.0"
group.dev.dependencies.rich = "^14.2.0"
group.dev.dependencies.types-cachetools = "^6.2.0.20251022"
group.dev.dependencies.types-colorama = ">=0.4.15.20240311"
group.dev.dependencies.types-docker = "^7.1.0.20251202"
group.dev.dependencies.types-pexpect = ">=4.9.0.20250516"
group.dev.dependencies.types-pygments = ">=2.19.0.20250715"
group.dev.dependencies.types-pysocks = "^1.7.1.20251001"
group.dev.dependencies.types-pyyaml = "^6.0.12.20250915"
group.dev.dependencies.urllib3 = "^2.6.0"

[tool.ruff]
extend = "../ruff-shared.toml"

[tool.deptry]
known_first_party = [ "flext_core", "flext_tests" ]
pep621_dev_dependency_groups = [ "dev" ]
package_module_name_map.pyyaml = "yaml"
per_rule_ignores.DEP002 = [
  "autoflake",
  "bandit",
  "black",
  "codespell",
  "deptry",
  "detect-secrets",
  "django-stubs",
  "factory-boy",
  "faker",
  "hypothesis",
  "interrogate",
  "isort",
  "mypy",
  "pip-audit",
  "pre-commit",
  "pylint",
  "pyrefly",
  "pytest",
  "pytest-benchmark",
  "pytest-clarity",
  "pytest-cov",
  "pytest-deadfixtures",
  "pytest-env",
  "pytest-mock",
  "pytest-randomly",
  "pytest-sugar",
  "pytest-timeout",
  "pytest-xdist",
  "pyupgrade",
  "radon",
  "ruff",
  "types-cachetools",
  "types-colorama",
  "types-docker",
  "types-ldap3",
  "types-pexpect",
  "types-protobuf",
  "types-psutil",
  "types-psycopg2",
  "types-pygments",
  "types-pysocks",
  "types-python-dateutil",
  "types-pyyaml",
  "types-redis",
  "types-requests",
  "types-setuptools",
  "types-toml",
  "uv",
  "vulture",
  # Runtime deps used indirectly (pydantic-settings, etc.)
  "attrs",
  "limits",
  "pybreaker",
  "pydantic-core",
  "python-dotenv",
  "wrapt",
]

[tool.pytest]
ini_options.addopts = [
  "--strict-config",
  "--strict-markers",
  "--tb=short",
  "-p no:sugar",
  "-q",
  "-ra",
  "--timeout=30",
  "--timeout-method=signal",
  "--durations=0",
]
ini_options.filterwarnings = [
  "ignore::DeprecationWarning:pyasn1(.*|$)",
  "ignore:pkg_resources is deprecated:UserWarning",
]
ini_options.markers = [
  "advanced: Advanced functionality tests",
  "architecture: Architectural pattern tests",
  "benchmark: Performance benchmark tests",
  "boundary: Boundary condition tests",
  "cleanup: Cleanup tests",
  "concurrency: Concurrency and threading tests",
  "core: Core framework functionality tests",
  "coverage: Coverage improvement tests",
  "dbt: dbt transformation tests",
  "ddd: Domain-driven design tests",
  "destructive: Tests that may modify external systems",
  "e2e: End-to-end tests",
  "error_path: Error path scenario tests",
  "happy_path: Happy path scenario tests",
  "integration: Integration tests",
  "memory: Memory usage tests",
  "oracle: Oracle database tests",
  "parametrize_advanced: Advanced parametrized tests",
  "pep8: PEP8 compliance validation tests",
  "performance: Performance tests",
  "race_condition: Race condition tests",
  "regression: Regression testing and detection",
  "slow: Slow tests",
  "smoke: Smoke tests",
  "snapshot: Snapshot regression tests",
  "tap: Singer tap tests",
  "target: Singer target tests",
  "timeout: Tests that may timeout",
  "unit: Unit tests",
]
ini_options.minversion = "8.0"
ini_options.python_classes = [ "Test*" ]
ini_options.python_files = [ "*_test.py", "test_*.py" ]
ini_options.python_functions = [ "test_*" ]
ini_options.testpaths = [ "tests" ]
ini_options.norecursedirs = [
  ".hypothesis",
  "*.bak",
  "*.removed",
  "fixtures.bak",
  "fixtures.removed",
  "helpers.bak",
  "helpers.removed",
]

[tool.coverage]
run.omit = [
  "*/dependency_injector/*.pxd",
  "*/dependency_injector/*.pyx",
  "*/flext_tests/*",
]
run.source = [ "src/flext_core" ]
report.fail_under = 100
report.omit = [
  "*/dependency_injector/*.pxd",
  "*/dependency_injector/*.pyx",
  "*/flext_tests/*",
]
report.precision = 2

[tool.pyrefly]
search-path = [
  "../typings",
  "../typings/generated",
  ".",
  "src",
  "tests",
  "examples",
  "scripts",
]

[tool.bandit]
skips = [ "B404", "B603", "B607", "B105", "B608" ]
