"""Tests for FlextCore REAL functionality only.

Tests only what actually exists and works - no fake methods or absurd tests.
"""


from flext_core import FlextCore, FlextResult


class TestFlextCoreDirectAccess:
    """Test FlextCore provides direct access to real subclasses."""

    def test_core_singleton_pattern(self) -> None:
        """Test singleton pattern works."""
        core1 = FlextCore.get_instance()
        core2 = FlextCore.get_instance()
        assert core1 is core2

    def test_core_reset_instance(self) -> None:
        """Test reset instance for testing."""
        FlextCore.reset_instance()
        core = FlextCore.get_instance()
        assert core is not None

    def test_direct_access_to_utilities(self) -> None:
        """Test direct access to FlextUtilities."""
        core = FlextCore()

        # These are REAL methods that exist in FlextUtilities
        uuid_val = core.Utilities.generate_uuid()
        entity_id = core.Utilities.generate_entity_id()
        correlation_id = core.Utilities.generate_correlation_id()

        assert isinstance(uuid_val, str)
        assert len(uuid_val) > 0
        assert isinstance(entity_id, str)
        assert len(entity_id) > 0
        assert isinstance(correlation_id, str)
        assert len(correlation_id) > 0

    def test_direct_access_to_validations(self) -> None:
        """Test direct access to FlextValidations."""
        core = FlextCore()

        # This is a REAL method that exists in FlextValidations
        result = core.Validations.validate_email("test@example.com")
        assert isinstance(result, FlextResult)
        assert result.is_success

    def test_direct_access_to_config(self) -> None:
        """Test direct access to FlextConfig."""
        core = FlextCore()

        # This is a REAL method that exists in FlextConfig
        config_data: dict[str, object] = {"environment": "test"}
        result = core.Config.create(constants=config_data)
        assert isinstance(result, FlextResult)

    def test_direct_access_to_container(self) -> None:
        """Test direct access to container."""
        core = FlextCore()

        # Test container access
        container = core.container
        assert container is not None

        # Test registration through container
        result = container.register("test_service", "test_value")
        assert isinstance(result, FlextResult)

        # Test retrieval
        get_result = container.get("test_service")
        assert isinstance(get_result, FlextResult)

    def test_session_management(self) -> None:
        """Test session ID generation and cleanup."""
        core = FlextCore()

        initial_session = core.get_session_id()
        assert isinstance(initial_session, str)
        assert len(initial_session) > 0

        # Test cleanup
        result = core.cleanup()
        assert isinstance(result, FlextResult)
        assert result.is_success

        # Session ID should be different after cleanup
        new_session = core.get_session_id()
        assert new_session != initial_session


class TestFlextCoreRealSubclassAccess:
    """Test that all subclass references work correctly."""

    def test_all_subclass_access(self) -> None:
        """Test that all subclass properties exist and are accessible."""
        core = FlextCore()

        # Test that all expected subclasses are accessible
        subclasses = [
            "Config",
            "Models",
            "Commands",
            "Handlers",
            "Validations",
            "Utilities",
            "Adapters",
            "Services",
            "Decorators",
            "Processors",
            "Guards",
            "Fields",
            "Mixins",
            "Protocols",
            "Exceptions",
            "Delegation",
            "Result",
            "Container",
            "Context",
            "Logger",
            "Constants",
        ]

        for subclass_name in subclasses:
            assert hasattr(core, subclass_name), f"Missing {subclass_name}"
            subclass = getattr(core, subclass_name)
            assert subclass is not None, f"{subclass_name} is None"

    def test_utilities_real_methods(self) -> None:
        """Test actual FlextUtilities methods that exist."""
        core = FlextCore()
        utils = core.Utilities

        # Test batch processing (real method with correct signature)
        items = [1, 2, 3, 4, 5]

        # The actual method signature expects a processor function

        def simple_processor(item: int) -> FlextResult[int]:
            return FlextResult.ok(item * 2)

        result = utils.batch_process(items, simple_processor)
        assert isinstance(result, FlextResult)

    def test_validations_real_methods(self) -> None:
        """Test actual FlextValidations methods that exist."""
        core = FlextCore()
        validations = core.Validations

        # Test real validation methods
        assert hasattr(validations, "validate_email")
        assert hasattr(validations, "validate_string")
        assert hasattr(validations, "validate_number")

        # Test actual email validation
        email_result = validations.validate_email("valid@test.com")
        assert isinstance(email_result, FlextResult)

    def test_config_real_methods(self) -> None:
        """Test actual FlextConfig methods that exist."""
        core = FlextCore()
        config = core.Config

        # Test real configuration methods
        assert hasattr(config, "create")
        assert hasattr(config, "load_from_file")
        assert hasattr(config, "merge_configs")

        # Test actual config creation
        result = config.create(constants={"test": "value"})
        assert isinstance(result, FlextResult)


class TestFlextCoreStringRepresentation:
    """Test string representation works correctly."""

    def test_str_representation(self) -> None:
        """Test __str__ method."""
        core = FlextCore()
        str_repr = str(core)
        assert "FlextCore" in str_repr
        assert core.entity_id in str_repr

    def test_repr_representation(self) -> None:
        """Test __repr__ method."""
        core = FlextCore()
        repr_str = repr(core)
        assert "FlextCore" in repr_str
        assert core.entity_id in repr_str
